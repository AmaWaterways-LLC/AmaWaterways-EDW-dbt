models:
  - name: agency_external
    description: >
      The agency_external model represents a standardized view of external agency data from multiple source systems, SW1 and SW2. 
      Data from these systems may differ due to variations in data collection, processing, and timing. 
      This model is used downstream to provide a unified understanding of external agency interactions, facilitating reporting, metrics, and auditability. 
      Key analytical use cases include tracking agency engagement, monitoring data discrepancies, and evaluating overall system performance.

    meta:
      owner: data_engineering
      criticality: high
      pii: false

    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - AGENCY_EXTERNAL_ID
            - DATA_SOURCE
          

    columns:
      - name: AGENCY_EXTERNAL_SURROGATE_KEY
        description: >
          A unique identifier generated by combining AGENCY_EXTERNAL_ID and DATA_SOURCE, ensuring row uniqueness across source systems.
        tests:
          - not_null

      - name: DATA_SOURCE
        description: >
          The source system from which the data originated, either SW1 or SW2, allowing for data lineage and quality tracking.

      - name: AGENCY_EXTERNAL_ID
        description: >
          A unique identifier for the external agency, used in conjunction with DATA_SOURCE to ensure row uniqueness.
        tests:
          - not_null

      - name: AGENCY_ID
        description: >
          The identifier for the agency, used to link external agency data to internal agency records.

      - name: EXTERNAL_NAMES_ID
        description: >
          The identifier for the external names associated with the agency, facilitating data integration and analysis.

      - name: PSEUDO_CITY_CODE
        description: >
          A pseudo city code assigned to the external agency, used for geographic analysis and reporting.

      - name: ACTIVE
        description: >
          A flag indicating whether the external agency is active, informing business decisions and data filtering.

      - name: HAS_ACCESSED
        description: >
          A flag indicating whether the external agency has accessed the system, tracking engagement and usage.

      - name: FIRST_TIME_ACCESSED
        description: >
          The date the external agency first accessed the system, providing insight into adoption and onboarding.

      - name: LAST_UPDATED_TIMESTAMP
        description: >
          The timestamp of the last update to the external agency data, used for data freshness and auditing.

      - name: SOURCE_DELETED
        description: >
          A flag indicating whether the external agency data has been deleted in the source system, informing data retention and purging.