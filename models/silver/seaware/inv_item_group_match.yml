version: 2

models:
  - name: inv_item_group_match
    description: >
      This model represents a standardized view of invoice item group matches
      across multiple systems, providing a unified understanding of how different
      systems categorize and match invoice items. The data from multiple systems
      may differ due to variations in data entry, system configurations, or
      business rules.

      This Silver-layer model preserves source-system identity and is used
      downstream to support reporting, analytics, and auditability, enabling
      stakeholders to track and analyze invoice item group matches across
      different systems.

    meta:
      owner: data_engineering
      criticality: high
      pii: false

    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - RECORD_ID
            - DATA_SOURCE
          where: "SOURCE_DELETED = false"

    columns:
      - name: INV_ITEM_GROUP_MATCH_SURROGATE_KEY
        description: >
          A technical surrogate key generated from the combination of RECORD_ID
          and DATA_SOURCE. This key uniquely identifies each record across source
          systems and is used as the primary identifier for incremental loading,
          joins, and downstream processing.

        tests:
          - unique
          - not_null

      - name: DATA_SOURCE
        description: >
          The source system from which the invoice item group match data
          originates, either 'SW1' or 'SW2'. This column is used to distinguish
          records across systems and ensure uniqueness when combined with
          RECORD_ID.

        tests:
          - not_null

      - name: RECORD_ID
        description: >
          A unique identifier assigned by the source system to each invoice item
          group match record. This column serves as the technical primary key
          within a source system and is used in combination with DATA_SOURCE to
          uniquely identify records.

        tests:
          - not_null

      - name: INVOICE_ITEM_TYPE
        description: >
          The type of invoice item, which determines how the item is categorized
          and matched. This column represents business context and is not used as
          a uniqueness constraint in the Silver layer.

      - name: INV_ITEM_GROUP
        description: >
          The group to which the invoice item belongs, used for categorization and
          matching purposes. This is a business attribute preserved from the
          source system.

      - name: INV_ITEM_GROUP_TYPE
        description: >
          The type of invoice item group, which further categorizes the invoice
          item. This column provides business-level classification and context.

      - name: OFFICE_CODE
        description: >
          The office code associated with the invoice item group match, used for
          organizational and reporting purposes.

      - name: COMMENTS
        description: >
          Additional comments or notes related to the invoice item group match,
          providing contextual information to support analysis and reporting.

      - name: LAST_UPDATED_TIMESTAMP
        description: >
          The timestamp when the invoice item group match data was last updated in
          the source system. This column is used for incremental loading, data
          freshness checks, and auditability.

      - name: SOURCE_DELETED
        description: >
          A flag indicating whether the invoice item group match record has been
          deleted in the source system. This column is used to support soft-delete
          handling and historical auditing.
